<!doctype html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>School Lunch Program | SIS</title>
    <link rel="stylesheet" href="/static/css/app.css" />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="/static/css/promin.css" />
</head>
<style>
    ol{
        font-family: inherit;
        font-size: 14px;
        line-height: 1.6;
        list-style-position: outside;
        margin-bottom: 1.25rem;
        list-style-type: none;
    }

    #form2, #form3, #form4 , #form5, #form6 {
    display: none;
    }
    .pm-step {
   text-align: center;
   width:90%;
  }

    .callout {
      margin: 0 0 1rem 0;
      padding: 1rem;
      border: 1px solid rgba(10, 10, 10, 0.25);
      border-radius: 0;
      position: relative;
      color: #0a0a0a;
      background-color: white; }
      .callout > :first-child {
        margin-top: 0; }
      .callout > :last-child {
        margin-bottom: 0; }
      .callout.primary {
        background-color: #def0fc; }
      .callout.secondary {
        background-color: #ebebeb; }
      .callout.success {
        background-color: #e1faea; }
      .callout.alert {
        background-color: #fce6e2; }
      .callout.warning {
        background-color: #fff3d9; }
      .callout.small {
        padding-top: 0.5rem;
        padding-right: 0.5rem;
        padding-bottom: 0.5rem;
        padding-left: 0.5rem; }
      .callout.large {
        padding-top: 3rem;
        padding-right: 3rem;
        padding-bottom: 3rem;
        padding-left: 3rem;
      }

    .errorholder {
        background-color: #fce6e2;
        border: 1px solid rgba(10, 10, 10, 0.25);
        display: none;
        width: 400px;
        margin: 0 auto;
    }

    .errorcontainer {
        text-align: center;
        width: 100%;
        padding: 10px;
    }

    label.error {
        color: darkred;;
        font-size: 14px;
    }

</style>
<body>

{% include 'slpmenus.html' %}

<div class="large-9 large-push-3 columns">
    <div class="right-content">
        <div id="appstart">
            <h1>Okay, Let's Get Started</h1>
            <p>Are there children in your family who may be eligible for free and reduced price school meals?</p>
            <p class="text-center" style="max-width:600px;margin-left:auto;margin-right:auto;"><img src="/static/img/addpeople_cta.png"></p>
            <p><a href="#" id="startapp" class="button round">Start Application</a></p>
        </div>
        <div id="appform">
                <ol>
                    <form id="form2" class="section2" action="#">
                        <li class="pm-step section2 child" id="childsection">
                                  <h1>Please list all the children in the household</h1>
                                  <h3>Includes infants, children, students up to and including grade 12</h3>
                                  <div class="row">
                                        <div class="small-2 columns">First Name</div>
                                        <div class="small-1 columns">MI</div>
                                        <div class="small-2 columns">Last Name</div>
                                        <div class="small-2 columns">Student</div>
                                        <div class="small-1 columns">Foster<br>Child</div>
                                        <div class="small-2 columns">Homeless<br>Migrant<br>Runaway</div>
                                        <div class="small-2 columns"></div>
                                  </div>
                                  <div class="row">
                                      <div class="small-2 columns"><input title="Must provide first name" type="text" class="validate" name="child_fn[0]"></div>
                                      <div class="small-1 columns"><input type="text" name="child_mi[0]"></div>
                                      <div class="small-2 columns"><input title="Must provide first name" type="text" class="validate" name="child_ln[0]"></div>
                                      <div class="small-2 columns">
                                          <input type="radio" title="Must provide student status" class="validate" name="child_student[0]" value="Y">Yes
                                          <input type="radio" title="Must provide student status" class="validate" name="child_student[0]" value="N">No
                                      </div>
                                      <div class="small-1 columns"><input type="checkbox" name="child_foster[0]" value="Y"></div>
                                      <div class="small-2 columns"><input type="checkbox" name="child_other[0]" value="Y"></div>
                                      <div class="small-2 columns"></div>
                                  </div>
                                <div style="text-align: right">
                                    <input type="button" class="round button" id="add_child" value="+ ADD CHILD"> &nbsp;&nbsp;&nbsp;
                                </div>
                                <div class="errorcontainer">
                                    <div id="form2_error_out" class="errorholder"></div>
                                </div>
                                <hr>
                                <input type="button" class="round button gotonext nextQuestion" value="CONTINUE"> &nbsp;&nbsp;&nbsp;
                        </li>
                    </form>
                    <form id="form3" class="section3" action="#">
                        <li class="pm-step section3">
                                <div class="row">
                                    <div class="small-12 columns">
                                        <label for="program">Does your household participate in any of these programs? <b>SNAP, TANF, FDPIR</b></label>
                                        <input class="validatesec3" title="Indicate program participation (Y/N)" type="radio" name="program" value="Y">Yes&nbsp;
                                        <input class="validatesec3" title="Indicate program participation (Y/N)" type="radio" name="program" value="N">No
                                    </div>
                                </div>
                                <div class="errorcontainer">
                                    <div id="form3_error_out" class="errorholder"></div>
                                </div>
                                <hr>
                                <input type="button" class="round button gotonext nextQuestion" value="CONTINUE"> &nbsp;&nbsp;&nbsp;
                        </li>
                    </form>
                    <form id="form4" class="section4" action="#">
                        <li class="pm-step section4 adult" id="adultsection">
                              <h1>Please list all the adults in the household</h1>
                              <div class="row">
                                    <div class="small-3 columns">&nbsp;</div>
                                    <div class="small-3 columns">First Name</div>
                                    <div class="small-3 columns">Last Name</div>
                                    <div class="small-2 columns">&nbsp;</div>
                                    <div class="small-1 columns">&nbsp;</div>
                              </div>
                              <div class="row">
                                  <div class="small-3 columns">&nbsp;</div>
                                  <div class="small-3 columns"><input type="text" class="validatesec4" title="Must provide last name" name="adult_fn[0]"></div>
                                  <div class="small-3 columns"><input type="text"  class="validatesec4" title="Must provide last name" name="adult_ln[0]"></div>
                                  <div class="small-2 columns">&nbsp;</div>
                                  <div class="small-1 columns">&nbsp;</div>
                              </div>
                            <div style="text-align: right">
                                <input type="button" class="round button" id="add_adult" value="+ ADD ADULT"> &nbsp;&nbsp;&nbsp;
                            </div>
                            <div class="errorcontainer">
                                <div id="form4_error_out" class="errorholder"></div>
                            </div>
                            <hr>
                            <input type="button" class="round button gotonext nextQuestion" id="submitslpapp" value="SUBMIT SLP APP"> &nbsp;&nbsp;&nbsp;
                        </li>
                    </form>
                    <form id="form5" class="section5" action="#">
                          <li class="pm-step section5 q3"><label for="q3">Is Jenna male or female?</label><br>
                                <label class="radiobutton-item">
                                  <input type="radio" name="gender" value="1" class="radiobutton-cb">
                                  <span class="radiobutton-mark"></span>
                                  <span class="radiobutton-label">Male</span>
                                </label>
                                <label class="radiobutton-item">
                                  <input type="radio" name="gender" value="2" class="radiobutton-cb">
                                  <span class="radiobutton-mark"></span>
                                  <span class="radiobutton-label">Female</span>
                                </label>
                                <hr>
                                <input type="button" class="round button gotonext nextQuestion" value="CONTINUE"> &nbsp;&nbsp;&nbsp;
                          </li>
                    </form>
                    <form id="form6" action="#">
                          <li class="section5 q4"><label for="q4">Is Jenna currently pregnant?</label><br>
                                <label class="radiobutton-item">
                                  <input type="radio" name="q4" value="1" class="radiobutton-cb">
                                  <span class="radiobutton-mark"></span>
                                  <span class="radiobutton-label">No</span>
                                </label>
                                <label class="radiobutton-item">
                                  <input type="radio" name="q4" value="2" class="radiobutton-cb">
                                  <span class="radiobutton-mark"></span>
                                  <span class="radiobutton-label">Yes</span>
                                </label>
                                <hr>
                                <a href="" id="submitapp" class="round button">SUBMIT APPLICATION</a>&nbsp;&nbsp;&nbsp; </a>
                          </li>
                    </form>
            </ol>
          </div>
    </div>
</div>
<div class="footer-nav">
<div class="large-9 large-push-3 columns">
    <div id="footer">
      <span class="steptracker">
        <span id="numformsteps"></span><br>
        <span class="progress-bar">
          <span class="bar"></span>
        </span>
      </span>
        <a id="arrowdown" class="circle button round right nextQuestion"><img src="/static/img/arrow-down.png"></a>&nbsp; &nbsp;
        <a id="arrowup" class="circle button round disabled right"><img src="/static/img/arrow-up.png"></a>&nbsp; &nbsp;
    </div>
</div>
</div>
</body>
<script src="/static/js/vendor/jquery.min.js"></script>
<script src="/static/js/foundation.min.js"></script>
<script src="/static/js/modernizr.js"></script>
<script src="/static/js/jquery.promin.js"></script>
<script src="/static/js/scripts.js"></script>
<script src="/static/js/jquery.validate.min.js"></script>
<script src="/static/js/additional-methods.min.js"></script>
<script>
    var section = 1;
    var child_ct = 0;
    var adult_ct = 0;
    var form_num = 2;

    function valid_section(section) {
        var error = false;
        console.log(section)
        $.each($('.section' + section + ' .slprequired'), function()
        {
            if ($(this).attr('type') == 'radio') {
                if ($(this).is(':checked')) {

                }
            }
            if($(this).val() == ''){
                $('#error_section' + section).html('Must complete all fields');
                error = true;
            }
            console.log($(this).val())
        });
        if (error){
            return false;
        }
        else {
            return true;
        }
    }

    $(document).foundation();
    $(document).ready(function() {
/*        $('#appform').hide();  */
        $('#footer').hide();
        $('#casenumber').hide();

                // Cache the form

        // Stuff for the progress bar
        var $bar = $('.progress-bar .bar');
        var steps = $('.pm-step').length;

          $("#startapp").click(function () {
              $('#appstart').hide();
/*              $('#appform').show();  */
              $('#form2').show();
              $('#form2').addClass(".activeform");
              $('#footer').show();
              $("ol.prog li:nth-child(1)").removeClass("active");
              $("ol.prog li:nth-child(1)").addClass("todo");
              $("ol.prog li:nth-child(2)").removeClass("todo");
              $("ol.prog li:nth-child(2)").addClass("active");
              section = 2;
              $('#arrowup').addClass("disabled");
          });

        // Initialize Promin
 /*       $form.promin({
            // Want to update the bar on every change
            events: {
                change: function(i) {
                    $bar.css('width', (i / steps * 100) + '%');
                    $('#numformsteps').text(i + ' of ' + steps + ' answered' );
                    if(i === 0) {
                      $('#arrowup').addClass("disabled");
                    }
                    else {
                      $('#arrowup').removeClass("disabled");
                    }

                }
            }
        });  */

        // Tell the button to go to the next step
        $('.gotonext').on('click', function() {
            if ($('#form' + form_num).valid()) {
                $('#form' + form_num).removeClass("activeform");
                $('#form' + form_num).hide();
                if (form_num >= 2){
                    $('#arrowup').removeClass("disabled");
                }
                form_num = form_num + 1;
                $('#form' + form_num).addClass("activeform");
                $('#form' + form_num).show();
                var element = $("#appform").find(".activeform");
                if (element.hasClass("section" + section) == false) {
                    $('ol.prog li:nth-child(' + section + ')').removeClass("active");
                    $('ol.prog li:nth-child(' + section + ')').addClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').removeClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').addClass("active");
                    section = section + 1;
                }
            }
        });

        $('#arrowdown').on('click', function() {
            if ($('#form' + form_num).valid()) {
                $('#form' + form_num).removeClass("activeform");
                $('#form' + form_num).hide();
                form_num = form_num + 1;
                $('#form' + form_num).addClass("activeform");
                $('#form' + form_num).show();
                if (form_num >= 2){
                    $('#arrowup').removeClass("disabled");
                }
                var element = $("#appform").find(".activeform");
                if (element.hasClass("section" + section) == false) {
                    $('ol.prog li:nth-child(' + section + ')').removeClass("active");
                    $('ol.prog li:nth-child(' + section + ')').addClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').removeClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').addClass("active");
                    section = section + 1;
                }
            }
        });

        $('#arrowup').on('click', function() {
            if (!$(this).hasClass("disabled")) {
                    $('#form' + form_num).removeClass("activeform");
                    $('#form' + form_num).hide();
                    form_num = form_num - 1;
                    $('#form' + form_num).addClass("activeform");
                    $('#form' + form_num).show();
                    if (form_num == 2) {
                        $('#arrowup').addClass("disabled");
                    }
                    var element = $("#appform").find(".activeform");
                    if (element.hasClass("section" + section) == false) {
                        $('ol.prog li:nth-child(' + section + ')').removeClass("active");
                        $('ol.prog li:nth-child(' + section + ')').addClass("todo");
                        $('ol.prog li:nth-child(' + (section - 1) + ')').removeClass("todo");
                        $('ol.prog li:nth-child(' + (section - 1) + ')').addClass("active");
                        section = section - 1;
                    }
            }
        });

        $("#add_child").on('click', function () {
             if(child_ct <= 10) {
                 child_ct = child_ct + 1;
                 var child_unit = '<div class="row"><div class="small-2 columns"><input title="Must provide first name" type="text" class="validate" name="child_fn[' + child_ct + ']"></div><div class="small-1 columns">' +
                                    '<input type="text" name="child_mi[' + child_ct + ']"></div><div class="small-2 columns"><input title="Must provide last name" type="text" class="validate" name="child_ln[' + child_ct + ']"></div>' +
                                    '<div class="small-2 columns"><input title="Must provide student status" class="validate" type="radio" name="child_student[' + child_ct + ']" value="Y">Yes<input title="Must provide student status" type="radio" class="validate" name="child_student[' + child_ct + ']" value="N">No' +
                                    '</div><div class="small-1 columns"><input type="checkbox" name="child_foster[' + child_ct + ']" value="Y"></div><div class="small-2 columns">' +
                                    '<input type="checkbox" name="child_other[' + child_ct + ']" value="Y"></div><div class="small-2 columns"><a href="#" class="datain remove" id="child_remove">- REMOVE</a></div></div>'
                 $( child_unit ).insertAfter( ".pm-step.section2.child > .row:last" );
                 $('.validate').each(function () {
                        $(this).rules("add", {
                            required: true
                        });
                     });
             }
        });

        $("#add_adult").on('click', function () {
             if(adult_ct <= 10) {
                 adult_ct = adult_ct + 1;
                 var adult_unit = '<div class="row"><div class="small-3 columns">&nbsp;</div><div class="small-3 columns"><input class="validatesec4" title="Must provide first name" type="text" name="adult_fn[' + adult_ct + ']"></div>' +
                                  '<div class="small-3 columns"><input class="validatesec4" title="Must provide last name" type="text" name="adult_ln[' + adult_ct + ']"></div><div class="small-3 columns">&nbsp;</div><div class="small-2 columns">' +
                                  '<a href="#" class="datain remove" id="adult_remove">- REMOVE</a></div><div class="small-1 columns"></div></div>'
                 $( adult_unit ).insertAfter( ".pm-step.section4.adult > .row:last" );
                 $('.validatesec4').each(function () {
                        $(this).rules("add", {
                            required: true
                        });
                     });
             }
        });

        $('input[type=radio][name=program]').change(function() {
            if (this.value == 'Y') {
                var casenumber = '<div class="row pgmcase"><div class="small-3 columns">&nbsp;</div><div class="small-3 columns"><label for="program">Program Case Number: </label></div>' +
                                 '<div class="small-3 columns"><input class="validatesec3" type="text" name="pgm_case_num"></div><div class="small-3 columns">&nbsp;</div></div>'
                 $( casenumber ).insertAfter( ".pm-step.section3 > .row:last" );
                 $('.validatesec3').each(function () {
                        $(this).rules("add", {
                            required: true
                        });
                     });
            }
            else if (this.value == 'N') {
                $('.pgmcase').remove();
            }
        });

        $("#childsection").on('click', '.remove', function () {
             $(this).closest('.row').remove();
             child_ct = child_ct - 1;
             slpform2.resetForm();//remove error class on name elements and clear history
             slpform2.reset();//remove all error and success data
        });

        $("#adultsection").on('click', '.remove', function () {
             $(this).closest('.row').remove();
             adult_ct = adult_ct - 1;
             slpform4.resetForm();//remove error class on name elements and clear history
             slpform4.reset();//remove all error and success data
        });


        $("#submitslpapp").click(function () {
            var slpapp = {};

            var childdata = $('#form2').serializeArray();
            var childObject = {};
            $.each(childdata,
                function(i, v) {
                    childObject[v.name] = v.value;
            });
            var pgmdata = $('#form3').serializeArray();
            var pgmObject = {};
            $.each(pgmdata,
                function(i, v) {
                    pgmObject[v.name] = v.value;
            });
            var adultdata = $('#form4').serializeArray();
            var adultObject = {};
            $.each(adultdata,
                function(i, v) {
                    adultObject[v.name] = v.value;
            });
            slpapp["children"] = childObject;
            slpapp["pgmdata"] = pgmObject;
            slpapp["adultdata"] = adultObject;
            console.log(slpapp)
            return;

            data = $('#stepform').serialize();
            console.log(data);
            $.ajax({
                type: "post",
                url: "/save_slp_app",
                data: $('#stepform').serialize(),
                success: function (data) {
                    var obj = JSON.parse(data)
                },
                error: function (xhr, status, error) {
                    alert("error")
                }
            });
        });

        var slpform2 = $('#form2').validate({
            // rules
            errorLabelContainer: $("#form2_error_out"),
            rules: {
                "child_fn[0]": {
                    required: true
                },
                "child_ln[0]": {
                    required: true
                },
                "child_student[0]": {
                    required: true
                }
            }
        });

        $('#form3').validate({
            // rules
            errorLabelContainer: $("#form3_error_out"),
            rules: {
                program: {
                    required: true
                }
            }
        });

        var slpform4 = $('#form4').validate({
            // rules
            errorLabelContainer: $("#form4_error_out"),
            rules: {
                "adult_fn[0]": {
                    required: true
                },
                "adult_ln[0]": {
                    required: true
                }
            }
        });

    })
</script>

</body>
</html>
