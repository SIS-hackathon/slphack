</body>
<script src="/static/js/vendor/jquery.min.js"></script>
<script src="/static/js/foundation.min.js"></script>
<script src="/static/js/modernizr.js"></script>
<script src="/static/js/jquery.promin.js"></script>
<script src="/static/js/scripts.js"></script>
<script src="/static/js/jquery.validate.min.js"></script>
<script src="/static/js/additional-methods.min.js"></script>
<script>
    var section = 1;
    var child_ct = 0;
    var adult_ct = 0;
    var form_num = 2;


    $(document).foundation();
    $(document).ready(function() {
/*        $('#appform').hide();  */
        $('#footer').hide();
        $('#casenumber').hide();

                // Cache the form

        // Stuff for the progress bar
        var $bar = $('.progress-bar .bar');
        var steps = $('.pm-step').length;

          $("#startapp").click(function () {
              $('#appstart').hide();
/*              $('#appform').show();  */
              $('#form2').show();
              $('#form2').addClass(".activeform");
              $('#footer').show();
              $("ol.prog li:nth-child(1)").removeClass("active");
              $("ol.prog li:nth-child(1)").addClass("todo");
              $("ol.prog li:nth-child(2)").removeClass("todo");
              $("ol.prog li:nth-child(2)").addClass("active");
              section = 2;
              $('#arrowup').addClass("disabled");
          });

        // Initialize Promin
 /*       $form.promin({
            // Want to update the bar on every change
            events: {
                change: function(i) {
                    $bar.css('width', (i / steps * 100) + '%');
                    $('#numformsteps').text(i + ' of ' + steps + ' answered' );
                    if(i === 0) {
                      $('#arrowup').addClass("disabled");
                    }
                    else {
                      $('#arrowup').removeClass("disabled");
                    }

                }
            }
        });  */

        // Tell the button to go to the next step
        $('.gotonext').on('click', function() {
            if ($('#form' + form_num).valid()) {
                $('#form' + form_num).removeClass("activeform");
                $('#form' + form_num).hide();
                if (form_num >= 2){
                    $('#arrowup').removeClass("disabled");
                }
                form_num = form_num + 1;
                $('#form' + form_num).addClass("activeform");
                $('#form' + form_num).show();
                var element = $("#appform").find(".activeform");
                if (element.hasClass("section" + section) == false) {
                    $('ol.prog li:nth-child(' + section + ')').removeClass("active");
                    $('ol.prog li:nth-child(' + section + ')').addClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').removeClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').addClass("active");
                    section = section + 1;
                }
            }
        });

        $('#arrowdown').on('click', function() {
            if ($('#form' + form_num).valid()) {
                $('#form' + form_num).removeClass("activeform");
                $('#form' + form_num).hide();
                form_num = form_num + 1;
                $('#form' + form_num).addClass("activeform");
                $('#form' + form_num).show();
                if (form_num >= 2){
                    $('#arrowup').removeClass("disabled");
                }
                var element = $("#appform").find(".activeform");
                if (element.hasClass("section" + section) == false) {
                    $('ol.prog li:nth-child(' + section + ')').removeClass("active");
                    $('ol.prog li:nth-child(' + section + ')').addClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').removeClass("todo");
                    $('ol.prog li:nth-child(' + (section + 1) + ')').addClass("active");
                    section = section + 1;
                }
            }
        });

        $('#arrowup').on('click', function() {
            if (!$(this).hasClass("disabled")) {
                    $('#form' + form_num).removeClass("activeform");
                    $('#form' + form_num).hide();
                    form_num = form_num - 1;
                    $('#form' + form_num).addClass("activeform");
                    $('#form' + form_num).show();
                    if (form_num == 2) {
                        $('#arrowup').addClass("disabled");
                    }
                    var element = $("#appform").find(".activeform");
                    if (element.hasClass("section" + section) == false) {
                        $('ol.prog li:nth-child(' + section + ')').removeClass("active");
                        $('ol.prog li:nth-child(' + section + ')').addClass("todo");
                        $('ol.prog li:nth-child(' + (section - 1) + ')').removeClass("todo");
                        $('ol.prog li:nth-child(' + (section - 1) + ')').addClass("active");
                        section = section - 1;
                    }
            }
        });

        $("#add_child").on('click', function () {
             if(child_ct <= 10) {
                 child_ct = child_ct + 1;
                 var child_unit = '<div class="row"><div class="small-2 columns"><input title="Must provide first name" type="text" class="validate" name="child_fn[' + child_ct + ']"></div><div class="small-1 columns">' +
                                    '<input type="text" name="child_mi[' + child_ct + ']"></div><div class="small-2 columns"><input title="Must provide last name" type="text" class="validate" name="child_ln[' + child_ct + ']"></div>' +
                                    '<div class="small-2 columns"><input title="Must provide student status" class="validate" type="radio" name="child_student[' + child_ct + ']" value="Y">Yes<input title="Must provide student status" type="radio" class="validate" name="child_student[' + child_ct + ']" value="N">No' +
                                    '</div><div class="small-1 columns"><input type="checkbox" name="child_foster[' + child_ct + ']" value="Y"></div><div class="small-2 columns">' +
                                    '<input type="checkbox" name="child_other[' + child_ct + ']" value="Y"></div><div class="small-2 columns"><a href="#" class="datain remove" id="child_remove">- REMOVE</a></div></div>'
                 $( child_unit ).insertAfter( ".pm-step.section2.child > .row:last" );
                 $('.validate').each(function () {
                        $(this).rules("add", {
                            required: true
                        });
                     });
             }
        });

        $("#add_adult").on('click', function () {
             if(adult_ct <= 10) {
                 adult_ct = adult_ct + 1;
                 var adult_unit = '<div class="row"><div class="small-3 columns">&nbsp;</div><div class="small-3 columns"><input class="validatesec4" title="Must provide first name" type="text" name="adult_fn[' + adult_ct + ']"></div>' +
                                  '<div class="small-3 columns"><input class="validatesec4" title="Must provide last name" type="text" name="adult_ln[' + adult_ct + ']"></div><div class="small-3 columns">&nbsp;</div><div class="small-2 columns">' +
                                  '<a href="#" class="datain remove" id="adult_remove">- REMOVE</a></div><div class="small-1 columns"></div></div>'
                 $( adult_unit ).insertAfter( ".pm-step.section4.adult > .row:last" );
                 $('.validatesec4').each(function () {
                        $(this).rules("add", {
                            required: true
                        });
                     });
             }
        });

        $('input[type=radio][name=program]').change(function() {
            if (this.value == 'Y') {
                var casenumber = '<div class="row pgmcase"><div class="small-3 columns">&nbsp;</div><div class="small-3 columns"><label for="program">Program Case Number: </label></div>' +
                                 '<div class="small-3 columns"><input class="validatesec3" type="text" name="pgm_case_num"></div><div class="small-3 columns">&nbsp;</div></div>'
                 $( casenumber ).insertAfter( ".pm-step.section3 > .row:last" );
                 $('.validatesec3').each(function () {
                        $(this).rules("add", {
                            required: true
                        });
                     });
            }
            else if (this.value == 'N') {
                $('.pgmcase').remove();
            }
        });

        $("#childsection").on('click', '.remove', function () {
             $(this).closest('.row').remove();
             child_ct = child_ct - 1;
             slpform2.resetForm();//remove error class on name elements and clear history
             slpform2.reset();//remove all error and success data
        });

        $("#adultsection").on('click', '.remove', function () {
             $(this).closest('.row').remove();
             adult_ct = adult_ct - 1;
             slpform4.resetForm();//remove error class on name elements and clear history
             slpform4.reset();//remove all error and success data
        });


        $("#submitslpapp").click(function () {
            var slpapp = {};
            var childlist = [];
            var adultlist = [];

            var childdata = $('#form2').serializeArray();
            var childObject = {};
            $.each(childdata,
                function(i, v) {
                    childObject[v.name] = v.value;
            });
            var childlistin = [];
            $.each(childObject,
                    function(k, v){
                        if (k.search("child_fn") != -1) {
                            childlistin.push(k.substr(9,1))
                        }
                        else {
                            return;
                        }
            });
            for (var i = 0; i < childlistin.length; ++i){
                var child = {};
                if (childObject.hasOwnProperty("child_fn[" + childlistin[i] + "]")) {
                    child["child_fn"] = childObject["child_fn[" + childlistin[i] + "]"];
                }
                else {
                    child["child_fn"] = "";
                }
                if (childObject.hasOwnProperty("child_mi[" + childlistin[i] + "]")) {
                    child["child_mi"] = childObject["child_mi[" + childlistin[i] + "]"];
                }
                else {
                    child["child_mi"] = "";
                }
                if (childObject.hasOwnProperty("child_ln[" + childlistin[i] + "]")) {
                    child["child_ln"] = childObject["child_ln[" + childlistin[i] + "]"];
                }
                else {
                    child["child_ln"] = "";
                }
                if (childObject.hasOwnProperty("child_student[" + childlistin[i] + "]")) {
                    child["child_student"] = childObject["child_student[" + childlistin[i] + "]"];
                }
                else {
                    child["child_student"] = "";
                }
                if (childObject.hasOwnProperty("child_foster[" + childlistin[i] + "]")) {
                    child["child_foster"] = childObject["child_foster[" + childlistin[i] + "]"];
                }
                else {
                    child["child_foster"] = "";
                }
                if (childObject.hasOwnProperty("child_other[" + childlistin[i] + "]")) {
                    child["child_other"] = childObject["child_other[" + childlistin[i] + "]"];
                }
                else {
                    child["child_other"] = "";
                }
                childlist.push(child)
            }
            var pgmdata = $('#form3').serializeArray();
            var pgmObject = {};
            $.each(pgmdata,
                function(i, v) {
                    pgmObject[v.name] = v.value;
            });
            var adultdata = $('#form4').serializeArray();
            var adultObject = {};
            $.each(adultdata,
                function(i, v) {
                    adultObject[v.name] = v.value;
            });
            var adultlistin = [];
            $.each(adultObject,
                    function(k, v){
                        if (k.search("adult_fn") != -1) {
                            adultlistin.push(k.substr(9,1))
                        }
                        else {
                            return;
                        }
            });
            for (var i = 0; i < adultlistin.length; ++i){
                var adult = {};
                if (adultObject.hasOwnProperty("adult_fn[" + adultlistin[i] + "]")) {
                    adult["adult_fn"] = adultObject["adult_fn[" + adultlistin[i] + "]"];
                }
                else {
                    adult["adult_fn"] = "";
                }
                if (adultObject.hasOwnProperty("adult_ln[" + adultlistin[i] + "]")) {
                    adult["adult_fn"] = adultObject["adult_ln[" + adultlistin[i] + "]"];
                }
                else {
                    adult["adult_ln"] = "";
                }
                adultlist.push(adult)
            }
            slpapp["children"] = childlist;
            slpapp["pgmdata"] = pgmObject;
            slpapp["adultdata"] = adultlist;
            console.log(slpapp)
            return;

            data = $('#stepform').serialize();
            console.log(data);
            $.ajax({
                type: "post",
                url: "/save_slp_app",
                data: $('#stepform').serialize(),
                success: function (data) {
                    var obj = JSON.parse(data)
                },
                error: function (xhr, status, error) {
                    alert("error")
                }
            });
        });

        var slpform2 = $('#form2').validate({
            // rules
            errorLabelContainer: $("#form2_error_out"),
            rules: {
                "child_fn[0]": {
                    required: true
                },
                "child_ln[0]": {
                    required: true
                },
                "child_student[0]": {
                    required: true
                }
            }
        });

        $('#form3').validate({
            // rules
            errorLabelContainer: $("#form3_error_out"),
            rules: {
                program: {
                    required: true
                }
            }
        });

        var slpform4 = $('#form4').validate({
            // rules
            errorLabelContainer: $("#form4_error_out"),
            rules: {
                "adult_fn[0]": {
                    required: true
                },
                "adult_ln[0]": {
                    required: true
                }
            }
        });

    })
</script>

</body>
</html>